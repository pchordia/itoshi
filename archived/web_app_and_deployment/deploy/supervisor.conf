# Supervisor configuration for Itoshi web app
# Place this in /etc/supervisor/conf.d/itoshi.conf
# Then: sudo supervisorctl reread && sudo supervisorctl update

[program:itoshi]
# Command to run
command=/var/www/itoshi/venv/bin/gunicorn -c /var/www/itoshi/deploy/gunicorn_config.py web_app:app

# Directory
directory=/var/www/itoshi

# User/Group
user=ubuntu
group=ubuntu

# Auto start/restart
autostart=true
autorestart=true
startretries=3
startsecs=10

# Stop settings
stopasgroup=true
killasgroup=true
stopsignal=TERM
stopwaitsecs=30

# Logging
stdout_logfile=/var/www/itoshi/logs/supervisor-stdout.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/var/www/itoshi/logs/supervisor-stderr.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

# Environment
environment=
    PATH="/var/www/itoshi/venv/bin",
    PYTHONPATH="/var/www/itoshi",
    FLASK_ENV="production"

# Priority
priority=999

# Process name
process_name=%(program_name)s

# Redirect stderr to stdout
redirect_stderr=false

# Number of seconds to wait for OS to return a SIGCHLD
serverurl=AUTO

